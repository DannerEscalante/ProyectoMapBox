<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa con marcador</title>
    <!-- Incluir la librería de Mapbox -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        #map { /* Estilo para el contenedor del mapa */
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>
    <div id='map'></div> <!-- Contenedor del mapa -->
    
    <script>
        mapboxgl.accessToken = 'TU_API_KEY_DE_MAPBOX'; // Reemplaza 'TU_API_KEY_DE_MAPBOX' con tu clave de API de Mapbox

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11', // Estilo del mapa (puedes cambiarlo según tus preferencias)
            center: [0, 0], // Centrar en coordenadas predeterminadas
            zoom: 12 // Nivel de zoom inicial
        });

        // Función para obtener las coordenadas del usuario mediante AJAX
        function obtenerCoordenadas() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    // Procesar la respuesta JSON
                    var coordenadas = JSON.parse(this.responseText);
                    // Actualizar el mapa con las nuevas coordenadas
                    map.setCenter([coordenadas.longitud, coordenadas.latitud]);
                    // Añadir marcador
                    new mapboxgl.Marker()
                        .setLngLat([coordenadas.longitud, coordenadas.latitud])
                        .addTo(map);
                }
            };
            xhttp.open("GET", "obtener_ultima_coordenada.php", true);
            xhttp.send();
        }

        // Llamar a la función para obtener coordenadas cada 10 segundos
        setInterval(obtenerCoordenadas, 10000);
    </script>
</body>
</html>
